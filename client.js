import { simulation_types } from "./simulation/types.js";

const tileSize = 20;

const canvas = document.getElementById("game-canvas");
const inputBox = document.getElementById('game-input');

var ctx = canvas.getContext("2d");
// ctx.font = `${tileSize}px 'Courier New', monospace`; // Use a monospace font
// ctx.textBaseline = 'middle'; // Adjust text rendering
// ctx.textAlign = 'center';

 // Define the padding values
 const paddingRatio = 0.4;
 const xPadding = tileSize * paddingRatio;
 const yPadding = tileSize * paddingRatio;

 // Adjust the character size to include the padding
 ctx.font = `${tileSize}px 'Noto Sans Mono CJK SC'`;
 ctx.textBaseline = "top";


const testGrid = [
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "A", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "B", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
];



// function getTerrainColor(char) {
//   // Get the current time in seconds
//   const currentTime = new Date().getTime() / 1000;

//   // Calculate the color offset based on the current time
//   const colorOffset = Math.floor(currentTime * 50) % 360;

//   // Define the base hue for each character type
//   const baseHue = {
//     山: 0, // Red
//     水: 240, // Blue
//     田: 120, // Green
//     木: 60, // Yellow-Green
//     人: 300, // Purple
//     房: 180, // Cyan
//     市: 30, // Orange
//   };

//   // Calculate the new hue based on the base hue and color offset
//   const newHue = (baseHue[char] + colorOffset) % 360;

//   // Return the new color as an HSL value
//   return `hsl(${newHue}, 100%, 50%)`;
// }

function getTerrainColor(char) {
  return simulation_types[char] || "black";
}



function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let y = 0; y < testGrid.length; y++) {
    for (let x = 0; x < testGrid[y].length; x++) {
      const character = testGrid[y][x];
      const xPos = x * tileSize;
      const yPos = y * tileSize;
      ctx.fillStyle = getTerrainColor(character);
      ctx.fillText(character, xPos, yPos);
    }
  }
}


function handleInput(e) {
  const key = e.key.toLowerCase();
  switch (key) {
    case "w":
      player.move(0, -1);
      break;
    case "a":
      player.move(-1, 0);
      break;
    case "s":
      player.move(0, 1);
      break;
    case "d":
      player.move(1, 0);
      break;
  }
}

document.addEventListener("keydown", handleInput);

function setCanvasSize() {
  const inputBoxHeight = inputBox.getBoundingClientRect().height;
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - inputBoxHeight;
}

window.addEventListener('resize', () => {
  setCanvasSize();
});

setCanvasSize();
setInterval(render, 500);