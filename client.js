const tileSize = 26;


const canvas = document.getElementById("game-canvas");
const inputBox = document.getElementById('game-input');

var ctx = canvas.getContext("2d");
ctx.font = `${tileSize}px 'Courier New', monospace`; // Use a monospace font
ctx.textBaseline = 'middle'; // Adjust text rendering
ctx.textAlign = 'center';


const testGrid = [
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
  ["山", "山", "山", "山", "山", "山", "山", "山", "山", "山", "木", "木", "木", "木", "木", "木", "木", "木", "木", "木", "田", "田", "田", "田", "田", "田", "田", "田", "田", "田", "水", "水", "水", "水", "水", "水", "水", "水", "水", "水"],
];



function getTerrainColor(character) {
  switch (character) {
    case "山":
      return "rgb(128, 128, 128)"; // Mountain: Gray
    case "水":
      return "rgb(0, 0, 255)"; // Water: Blue
    case "田":
      return "rgb(0, 255, 0)"; // Farmland: Green
    case "木":
      return "rgb(34, 139, 0)"; // Forest: Dark green
    default:
      return "rgb(0, 0, 0)"; // Default: Black
  }
}
function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let y = 0; y < testGrid.length; y++) {
    for (let x = 0; x < testGrid[y].length; x++) {
      const character = testGrid[y][x];
      const xPos = x * tileSize;
      const yPos = y * tileSize;
      ctx.fillStyle = getTerrainColor(character);
      ctx.fillText(character, xPos, yPos, tileSize);
    }
  }

  window.requestAnimationFrame(() => {
    render();
  });
}


function handleInput(e) {
  const key = e.key.toLowerCase();
  switch (key) {
    case "w":
      player.move(0, -1);
      break;
    case "a":
      player.move(-1, 0);
      break;
    case "s":
      player.move(0, 1);
      break;
    case "d":
      player.move(1, 0);
      break;
  }
}

document.addEventListener("keydown", handleInput);

function setCanvasSize() {
  const inputBoxHeight = inputBox.getBoundingClientRect().height;
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - inputBoxHeight;
}

window.addEventListener('resize', () => {
  setCanvasSize();
});

setCanvasSize();
render();